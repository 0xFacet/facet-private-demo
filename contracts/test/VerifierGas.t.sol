// SPDX-License-Identifier: MIT
pragma solidity ^0.8.24;

import {Test, console} from "forge-std/Test.sol";
import {HonkVerifier} from "../verifiers/TransferVerifier.sol";
import {PoseidonT3} from "poseidon-solidity/PoseidonT3.sol";

/// @notice Gas profiling test for real ZK proof verification
contract VerifierGasTest is Test {
    HonkVerifier verifier;

    function setUp() public {
        verifier = new HonkVerifier();
    }

    /// @notice Profile gas for verifying a real transfer proof
    /// @dev Run: forge test --match-test test_VerifyTransferProof -vvvv --gas-report
    function test_VerifyTransferProof() public view {
        // Real proof from E2E test (paste hex bytes from test output)
bytes memory proof = hex"0000000000000000000000000000000000000000000000042ab5d6d1986846cf00000000000000000000000000000000000000000000000b75c020998797da780000000000000000000000000000000000000000000000005a107acb64952eca000000000000000000000000000000000000000000000000000031e97a575e9d00000000000000000000000000000000000000000000000b5666547acf8bd5a400000000000000000000000000000000000000000000000c410db10a01750aeb00000000000000000000000000000000000000000000000d722669117f9758a4000000000000000000000000000000000000000000000000000178cbf4206471000000000000000000000000000000000000000000000000e91b8a11e7842c38000000000000000000000000000000000000000000000007fd51009034b3357f000000000000000000000000000000000000000000000009889939f81e9c74020000000000000000000000000000000000000000000000000000f94656a2ca48000000000000000000000000000000000000000000000006fb128b46c1ddb67f0000000000000000000000000000000000000000000000093fe27776f50224bd000000000000000000000000000000000000000000000004a0c80c0da527a0810000000000000000000000000000000000000000000000000001b52c2020d7462c3e8ff7dbb6bfd6f387c93d466c7d3556731187ede78309c6914c15a117442d2d855e48a6cf7d615cbeaf57656c12d0483596a286fe71aa941767e3b775f5f21c6b40b82855edcb10b85342902468492f0ae77b1217302a30b803e9545a012d299ffe4df20dcf991dd2873a520ed2d7779ff57e590ad9dcfa59bb10d240f9790438b00f427f25ced2bec310c9930062b47486ef7129a16a99daf0848b25e6142c9f9bf90a734cec4d4173f7d14af09a28ed1ac0a566acd739612b1a35ba81f7035e2c76007922e52ce1bdb3c9062888ac364cfd8f99f82a946360748d64e569051f081ae6f2b7fdd87bf0a9964fafc613decb96ec055777e32614b544454c65218fad68f665ea94face1330719f9f3e6397ec297b7bc321b19681544379fb8a1e95f09d4bf6d291037dcebf256a088401343040496df83e01b44b327e4f7184131ad3f5de048b65fed79911795de474f4b6dcf4e58a8f83610317daf0bb51e0015226ad7dc889db84eadaceb3f69b72073baf2b7ea23ab1cdabcb258880a3af159737caeb71466c248b55c4b82aa503f6cbe7c25f1cdf1c5342d3624e8cc7b120925753606e09b85bc686cec8834c218d1615666548e9bf70b76f375541f236193de8075a2d8bc3d0f093ceadd3f49fd9eed81ba280d8235887d580dd31a5ef2b9585892e6803b4e13c892f123b61411564546697854aa95aca2a57c1744d38020f32c1022728035358dd0073d05148f71fc1979d56fdf51ca3ba783922b7e30409712f8330c07579462c18e8cfa5d754cb4d677c1c493d45258ed3db4fc8dd00740a6bf9f6f5c1e97f24d6b0d6e29dd4ce0e422ee59806052d2fe3d0de82640ce0c8c18edea6ca18249a1a6c4b34abd756d2969af7abccbea9c978ab9bfdc606b4ef398c683e732639a65a3e0dd6cc4542a0b14537c97f6b6c74da7109f3ac161888515285dceb8118ee3e547a0b4b325c8e6fc5f0773b345e5d5b1b440436245d23ec7c9417bc78e17c253240bb528ecd1f390b7796bf83f40e66b34458d81d01b6f77d777c4fd515ec9655ef2454707486a7ede27c3f3f3bdad18bbccd1a009ad63d8f104cd3b464c5aa0d863d4d258ad06cb30a7be9a8398f3b3c8f0eb406210e942cd0902941883c821596e66cbc8efd38c666b0afa3a8322a7dcc31dc244d429dcd6e99d3675ec85f0b6136f433a6610ed2d9d6e0299da18ae00df2d708d85eebf123bd101ea685ad309895a15c414d0edac47dc07a0874e90bde45551e258eacb87e790651512aa08a82694ff4e9f53ade89b1faffc89e518c58fd9d0f8bc95d145386f70918cfa2f6a281620e9216df61ec207c7ba43f2ea24b41a20e132ab7a25c4fb636f67ed72e9a80f70199db040d78c8462872c16e83fde7361d553f9e1fc0df470c2785f51d1835b1b1442da7e1bb8709e525fb5aaf7c65251d9699dc74ed10bc02608e37b3f3fc13df9aec569495c4ed97db3b7fd46d2d050592f4f53ffcae5a02a87f5a8ba5f0958d3f27e6f4eecac7d8657776a0f10f69175ed8fe4d995ce1e2dc8b624b671bffa344f32d4f397410bdef0fad16d60799065a31389387f4773c5263f5eb97d176db76a169c8f8ef9a099c407d9765dd4e0f79c1ef9efe59bf6e28dd6e40677bff68df6eca486b4a839c388e4ce15e884015d96b5868c2876e59ef3363eaf472c0f4d916c476d792b5e95e452fd205df81237dcca00b7a062f86af5a26bf8cee065471f7b266c44f5036b2bb016d2c931c17e72d484ea2a525de8057b00a38e4e8069241504ba45d26f3e95fd77872f7262266a655edceb25fabd17e9ecab5f550f09d4d308d716813f6647cc3e306aa2128d58fa62c536c5e3af13ee5563564eebc9b2b5d812d3c3bba59bbfa7abe731f131f3d8c717b8a97bb21c82188668dfbfea7db9260934e173b94a64b3bbbbee524f69902b5c4e40ce881a3f342533526def61348c56454e8e8337af75087f9ec19c7982b4b2cc309497ac8058c6d0a701aa9eec10f6429c12d7928995aefc400145d0256eee6ddb6e8676918288412650c42c9fd8b9dca6038ac4913a119f7d305f0539a840209dfe8a5c94eaf0078e1b518d74cab9993a54a1e5eb16b91528f0e902e42a8fa88927f74c4bc7e4abc2ee840519d1adfee97bc1f11600fd02e3b0eb84759c6c8a60eef0ac0178fff51614f8a877e26782f8f8a75db23b54c99c200c28a991b875026ea017569272323d2d7a4a3020da8e3de58ba4df0dea0b10925eaecd12cc5e076af13387d424a3383224479fa227479656099fb9d01410c250adaa27bd3eb9b6c0b88d5aff05088964e6ffd577ee2117b8f17de8b1591e24e249852ee82decf4f5f2d167a787c3a2c40085a102d1df74f1a72ac261aad78de0aefe24b0bc934ce41e92a2b82c00f70f24cf6f4a9e2e9a9cb457956c218d73610307e45013f5e205ba9b236034605c2cd475ca2dde6c6731af1c94e59220ef0274b89544943ca15b0b7cac9766d3e65c0c6ed39602bb82bcc9738c7ce80e2cc0325aa715caf22189753be492f8f993e10ec24346017cc24a2d12dcee5c2abf5010612f22fcf69862bca14cefeb4843979058f3c6f57e18631d4e7bec9120dd4072b00fa418f1931a95255a48dab72990976473112de1f9ada5ea0703e7a994b19d704b42a441c5a13a91998fa259bd63df325d4866cf457e73f2dbaf08faeae08c676fb6f19b9c4f852b1c0055312442285bb5effaca3d35d3433ead2cb614b1129eb97d509b865995d5ffa755af98bd22c43884f337639dc8922706137f6e213608057b5898609d9cc071262d18a2974ead89fc4249aeafc48778ff204bd66124241accf0a0fc76280cb1ebf275b94a1e3f550c7ffb039bbb00547f04d04d22a81ac808896dd627e05d0d8acfe727412a974276805385bd08829da335de9700b7c3a04c8bd662df8412696837557c0aa6c2e21ae31a012d777f4475d4421cd056413687fa60fb886de5b165922a4e29666628356cf908b950793fe62108673018c30fb85af9102d0f5f56ade3246a50f9c46179d0164b67bd05fdac48789da01e01d6f538e6f491c0bb86f1b206b07bdf2aca4a8bd23ba7ffe08c512b105732a7250792313d06a179cc747c1d5e78b9c15dad64052b77cc73ea49b13160a4c066b2b9c41715ab12f1a1ba9207359e49f25cc3695c4fbde627c63a8d81630961fb4f5de41a5fc56043dbe1a4be6f9d9770f350eaa8b8e3c02c20586f98f309920576eea42838f38d6f1820b5193eaab796d4d3f20e6a70819620b08ed37ee8507d0225a1b404181a771909625f64e88d0e95e8f191997bd9605fb3f1bab24a318e804024c7584a07d3bd51f1ad6781403e8e6187c174f23d9bd8984b29e67740b9519b81e9ca3b20cb074b59f3a1a699b64f425497707b9e1badb4902d5c6b41ce4e5eef11a807035a4bbc403d20c1b2df88f033b20dd055048ee2c0c992ec425265eeb99280d5e8355384f62c7de80595cbeaa44c9cbf4e880df218ffdc761073b55902d03b488ebfcb6861d4550a2600922f4613f423c551af3101384a0560667a69a5e723311999d442ea74ffa13ad5381c423fde76cf41c809984e521a02e6ace97732073d492284aa8c3952fd3ff6f0fbefeea080a7891a578170709e41154fd17b71de28393bbe7dad04883830dd4ebea964f189fa04871a978a01c4005074ad6f0d3265896b6d189f6fd10375744da4b4b0b437ba2550311335cf5731e108eab40af0bd718617ea8fa703954ab0c6006d61e3375c9c5473a5e96df522fac31cc3d4c30405263e08a44c7b8cd1af2e2d597f2cb0d2264cd77faeec6bd17584831a86547bc4f6258279e3d9b75ea0c985d1748a520c6690ce4872759220143fa0309804e14705dc9b74800fa318596897945b3ffce4f8c25ae281700c30c3a4064ee499db7f522490953366b8856ebbc628654f55325ac80fe0869b2591ef1d4e20cfc240e36beb1dcc5abe768fd339183442bc061182811308c4cd79d2aa6d7811bf56a26f8a31f8509263a30505cbdf7f696b20870339943d4a75f7d2bdf0298245ca50b1cfbfab7501b75a0dff4a8ebcf305264bfbcf8ea6ba0f4440036f538f0e2c5f6b4f7684b529440953cb7af191eaab17ed2e9e643830982771f237d659bb5905ff24601d52421b9779215843eb40f36b002f425d5e147564d1d3f0e9d39560fe139df7069f74ec6d1e186d1a68f6dba7d3aa7d7bd2c069f7a15eab42b6debf68e62ab94e78578a5a7d65c737a48e8961734738b2a94a9d1720c020bd072c5418f0a26535a1eeabf58c795b6703d2188c4cc1e497f807fb72008d58853d2f72238b8b063f031b2491c09c373afd18ee9b9e879de151bbe177117ce4b51ecc4a2674ec7036b04c322fcca0a15a65a1debdb52472e44ed2577be1c2166405f2a01a313cd756df075979e86db1043c16aea1138ba5744a4242ad0062bb3ce3d44deff75fe853d2665e46128e8f304340d186ee6a7d32b2b803acc0cb3ace6e2c798c5572424ee839b94fdc12920d22ae6ef744e31f389793453a60aee3b630c56aea92b6617d30024b66a93a31c715e2c99ba8dbe715d9e1fb0db0d485cb67b5019e63f9741fe097315863965ddac2ccfdb8f0cd34d61fb6697f52a6abd5357b6020a6ab11fd92dd08882776167b9d9a8ffdd6093c6bc1f4a8c450c1782e698e9ea6b2e89fb9a9a0063aa46914601dbd39ca1c369cb95acd5b4bf2d1d7eb22b011015d175868a13f118130849c75215a97980cc53c6bd69ddf95112b8542c3af80a2db2834f7d2d8d4900ca42a30363d9068e49fd79b99cbfe87e2dfd06650284f48df0f7e4dc1871340085fa5c09b3ceb21d828d056f002620941ad402139e6480f3790b479c165e38a08101ec94723e167d922cc49de0f6ae620c332201e3073db0e8cfc47a671d20cc3d6fa7b0cb82e160e7fe81d691b4dc541d5f3f32784bef5e12ca493b879d1c54cb71785a002ec1405f936628c93fb7060b03897ded26bff3cc72b370cefd7b151877b250ab37f75d3390e5b409f4a2be3041fd45b525de663c7407d83867290d5a3d9b42ef0272686afef58433f1fafd267e186c4e0db98908f8f07fb2d31988b8985f2dd0c7e4d77caba56c1262462907932d95987cc46a7e5e3b3e3e0f924c74b991432ab57d3c10c475012889151d2937be21f71f9ef11fde213bf8c224a7539cd0f8f753479a1436ee35d592bc462446c52ac162191d9743f6e3450a2b38814ec5e3f7e7f7d14ffe4ca1b1203b742efa4596fd1929e5759744ade01fa92533463fea208d397ab6d8b5d3da9e2b50134d3d1f0608d499f3fcfc9ad2819d69952c00bdb81c4fde27b4edd7c5a55cb907cf83bab642130b3235047b30292468f575c05649cf4d7a59dd395f6060e2e00bde2b6392067345bb023b7e0b9e5ea27579527617d52673513e4ab7fa3166d01f8fd3a09772036383810398ec791dea1daecbdeb59afc347fe338895e162b4a06c033095ef4bb4b8a99089c549609fe72614383a557c284180aded4efd307e126d736624b206b8a4d3f3b213ac1fe686c70dcc2a74dbd2327b854abdd5be35f0499bc186ff7ecb54c023bef4e58e6ca44f7b14e481b62ba19fa85a3190f33d406008386bfc27c3dafaed3b74cd02dfed590d16ffd0da100b55f682628f2496a0cbd788679b2bc181051ae8c47df06fe3aeae7b250d021489f0a41796dfa994f260bc4a1e4db806530bd32662e7f52903d67aeefba2cc65c1aa10b274f6c854e1bdc83ad48888c968151955efca534147a8fadb3f5a1f40cee30d098bd3c1d6903724da5442ba60b8554883cf194c91484c3cce92faa1eaab83687954a4f63d00964e6cdeb923d3688e6c6586311bb07f55b3c4933d583ceae0178eba2512ca224c825cf74f970283c36787f395d4a90efa7a8f67e307df5b1d61cb1e0eaa9c821b63ea2b8432ff453d2715cea1c5dd0b18838149065417c856953bdf75b818f0341844c5f62848b4a9c9ea6ef31581428f39ab4a148ae7248e2c0129e7d5bfc2b192f2243f77a04cb309a69dc0e78ab7ad7504592eadbb43b0620c94af3ed0317c9b9365bc40145605acbd4614723b45a4a4d4f5570cf25f2fa70e79846e4b9104c816bd00c98194532830a9156acbda489eddd704a0f824bfc74691f1f275e0e3dd88a139f6f627850c9b44f9b963adc6223f9dc8b6f03fa6ade4c9d8cde050da2f3b7d8397af22a40631f989211bb65fc2682e40469fbe2f947a7b4187948006529a44a947aa5e29cdf9981c31836c096f142239d306aa0a3afea44b6babf2c65d8b0043ba249bf61f9788c91e7f277ff4c7db8b277e1497793a84fd07a5b146f754b4f9e44ea237690592d7df02e82bce9a1865a34470cd51d8730bed3d0078dc967cde85bf07a240c16c6d97a609b4b93613b97563649ace41a86d2bd47043630fbb573700b5fd75b92257df1ca9d4de8c61c72b1d15a0c355be0c675a406bf6252d579f58aced0512e168eafb8ef5ce9c4bc28a9e68ae5810113848c210700c561ba3d27266009ddc6c79d34330e20228c03998f0e6d71ee9d1b62bbfc0c8171b81f56f8e490818798713081a3f685cafa4776e0ac46082f4f3351d1df2dfe257b0f53ad672c93a67f78138e9a6e589912e7fccd233237076b9849738321ff65660f84a749a2e21f1f12244d29dee739d907934dcd3e5e52cfd0012e8b0c4c6cf208392b9f29fb2e5c0d3c12737c407ec9677e1d62590074a28e1e57bc14a85468ad623fc1b9853a7840690af7a1e25a0b275ca8cdabb4b101246693530f15ae443a88a9f1fb815d288faf207c1488010f2a2e44da5ea41a6e1c464d1516a702ec4e19adc3a309bfeac58f624549a6c94d5db7eaa163a1473b7da032ff10ed2c5cd28827d139126c4bf7f3601b37af88a3dd4a59d1b1935db3fc9440010d1b5838a84a83918e2fb3ad846e2578e538f8fd49c38adc38fc1ba18a63b55407ce51a0095f9fb361d3da25cf58af4c2800d2887cc2b71decceb547c2146f882bc41516485f0dd8d487ac1c5f7e06758e46c2f3de4ef3f739d1b1dafd0ddc273005f4d09a71685e27287bf79b79223f96bd92d1ca93b068a147760b13c861811cdf4ff3f610219833766c71e4a69765591f9751c3a4a69f51d6222bc2065e950b8506267ad56508bbe5144a0823facad7982019ca8d8a924f536d0e061b17422b294235f212207048a3d0f14ad59936628827f8a083e98f46d17a45e4a78c692e636c45074c46777c63c7c18d8ceb78d5ad46608609125fa08c952f89fafa3221c571b7a630ef2b8b58f17200cad2262b3e871e220bb6dfb7c3180a6085fa3c1217eaf18d21effdd22eefb12a9ef033781e42789ff3899e019f6ac781dc548e1264a01a1c39ac6f32a0b57448312a005dc8acdfaa306b7b2aebb776e278b00802e918d8cafef3c9c817cffa995bc25caafe55b2ae4de958f75e33eefaad4f1723b3f3506f69d4fce6c69407f84e858c47bf62d69b30d47aad18872053923deb2cd3735f92d97ffd9b134510724beee9992a0858d07b0d3b1b7bab3f4489574f17d09ee01bedafd1a17ea9c2158b4ce7ada105f4bacc1a74a3d33704e8af678529e1a28c58b9852fe1e5646fdb79bfa1c3752793f20a618ef19248dd474e24c616ecb21681de3a2f074ea56e9a366429af12977506a0d6af429dd66b7af2b99d06790eb2e9f820a50de165ac57540f85ed9586c2a59d80b67378376c2220edc62909319cdd45e1054e8b61fe1fd7304110abcaa48e6a54d7bbc20ce589baa2de167696528ab44eff562cbc55f99a03cff1704febabe7801853761de353aead6f08ca35a0d0998f8120701d80436bc353d5b8bd0d75c96f0fd928e326baefb0f72cd79a42b42e0a7c1105315e97924a2c0730584fd51dee69aab543e282817094107a743aacd2e81742fc826a71f2ce3929a18092db8d3533556642c38bc4c2a20399fb47ae14c796c301ae32f499d5b861183a764ead682cbfdf7575fad781062c5782875071bcfc50d47c3fa918aa662ea946c0059fc9719f7b8c1711b25a5520b2f4799f43e403195ec07ce629ed691396d2010a79e5bdc4b980daa547de4e1a75c4e02e331e1b8fb5bfc7262c6e765ed4b8f6faf232f6e3a3e51dc8531d1e0f7fc65e1bc49f10a6f83364d90e98f0fbccf8e38c84bd331b466c8f2f4692270674453cab9fd65caef413980195c78201b4c7a03869ade42ee8075ab3e142e007ef9ee8e7dab4f25e8fdc7040889500f163afef135727b44657efe892e988f81a0a4efcc3ac61ef014ced8315739d2460b798b50807b383701b6eff4de0717c24a08f5ef56b36c3d289fb93af293c94e1011a1da4a7fe2d39c5fc822bce270910027fd8429df80fcb69f7d34e7195e0ba2a17c227b532ce6570f07d0ad6c8f71335476bbf272c3765d5796b9dbdd91abae2ac87d2854349eb1dd566126e4fc52d60856aeaf6de0a61b44ee2f5c3492d55b2d611c53bf1068e636dfeaca9a12a10771d52ddc4ee0d9f3ef54bf4c3e06b18831af1d064c400853a10bac566f5e823d688bf98db53735be608cba2702d69a496fb8d2860629f0089251d4317b89a2d425fc840aef200cf8283360488a7ca6a894988433c12d095f806170c4f39a71cc6124e841d8b2906a9c462ce2b1c1a319d097f4acdea92e71101496ab1a1852bb72103582002cf6665ff6fc00b5a8d6db598d4af93830b9a112e2fa05095c41540d91aeb57931bb8efeb857579bcb666b139371026aa295b1b3774295d2c782cab05e01b1e829818faafb8b8ea520d9cf21a828cf9178cc1eee068bc755f5d1bf3b997f88f9534ac1c2b7285ae53531d30d6eba19e663ee70872476a321dd7009cd923a9933f3fdc1188b6c034ef4156d341c24e087b72105ebfc7ff910eb80be60e0e985c138e342006e7d01812735490f47b6782dd8693ea401b47aae4ec2888efef741cc76bef0287b6f324224c1e0abfb94bd5cd664f5ae6cfcd9983c206c3f74316dd90a4373bad473ba49cda63212400e9becea6e97db2cd3ccc1191162c9c62c4e6e1606e35ddc5959b41ee7e7651b4a698be3f671ee2f08e54a5d6000b90291492214a509e8e2c2622af5b5283e734ebb3b2ed7405158a449da1742cc153f65966118ef6ec4e1827288410f448fb6c16794d1726b190f9ee01388e1673a981406ede88f1461ba268c075abedd4fda084a027fdcf00ce7455bcbe28227a7bfe70cecddad40d7c099be862b7b744eb437e9943e96efe081509e2f1d606c688a3cd91d0afe5fb97718df153d51e0020a0e701527c0bda80c60b49413a1fa394baefbdd80d1a597b0a8bcb6c5e139ca84bdff625c29857eb48f2d9d9cd0d54112070df35197034737c9b2cfbf90b9b25a07d05348672e5b4749caafcbc03adf62038a5eb2a7fd27410533265911f8de3996d9d764f6e7534865c93c95d2f80e221786afafa81225b97419342b86211d16eb0309c364353e5a2a55b50c7286f0b84ff075f8a754f7f6b5f54de81555b6fabfb2d3e062b27f4cd001e135512bc3cbd9d38421c310f359c487befee0dc3e7292d154ab39fcce165f6a566361798eeb16b4ae8d9b3bebb2d5ce1cd6b514c5527b85253fbeb505a44b971ae91216a1a07f2c2ac8c9c2f0d96d07cca252639febe9463504f65d39b2e3a1d013c088b12cc13cc2b6c05f0f9bd15bacd60cad8c5014f27d5da5734522e5b099aa913d146d267343e7064d1b2dfd2455da6a30260f93fd72de9adb12e058c54180927ecb9cd6b90a6073d9f06329f3ba58a8295d5b1e89e77fb54bfd5b75644edb70874d3b749f0937fe7c5e270d6939999307df72e6ad44bd7b18ed9bb5efa8c10003b2cf5f4ad589b313c7d68b1f5a6c56c0057fe74b609f10861d14c175fae8525569311671cb41eebafd3b9797796f0d7fa269f5bfc36d97344e34409dc5ecc1371744bd91b05f5089c2c17c6fd60193d9cbcf5d5f741f8ad1ff1aac90a8aca052b3ce814dad1e87e467aa3a72c8a1dcc2cdcb415952b90600286ecd2b6b01e08689ae20c4c9eef65a00496ccbf65b8cd754e4b08096d225d59896e69c2a3391d94fdaa6c20949dbe11a77359fe7e4d292a62849abb090a131fba5740eed9680b80536e76de498fb61ddfce0e57c46d0cb8e3bc149e39c737128c67277483072b0627df6d30f93cb902d3146be358f65ddb60dc331fe035663db6acd163c3922b2f8ec4224bf66fe00f19cb725aa61e102f1989a54f1793e21f3a790972e3f81ab5ebe6bbc6306e8f79f0c3f3ddc9658784fee497125692c3b25aa2416b13612598c823a2fc25b0394cd0f72a0feba8b6ff3ab8a9e552f84e3fbea6f369451b23766eae485ebd87a6bc630b5a74d50a157983ac258da08a0a70f7a7044ed4252fab8352c3bcd0267031f55f96a41419af7fad41c9fd7fb5adf7d840e4831db202e16354c88721e11598e7da80b0e8a446394d505617a5515a27ea5e8cdd925d0fc17c29ff32f5301a2379618f5af78790de2d07df7dbcfff5e936da14d7149d26ef9444e87438f6e324194cb989a5cff64a5e1ffbc2b405bb658dbcd182747f27336efe1a7c1bc365e57b75d9303c6ebfa486c163f8e6d2b7e62968ee31eb130e1b3baa36749e2021dfce2414161bc712140df5352bd4e52ece8edc7b294bcd081aaf43afa1778ded5bf6db5cd4f719b8bfb6e8c69c6af8ce2475d26544f66905773dfeb618b98930b2ca41a5bc3746ce1771c63b728bc1e0f699bb07eeb2c712628c8c600fe081345abb0efe599b55dab54056f5155850b3d8b41a372b56a024a2fede5c00ae0d2201e1fc231ab83c57e5d61ba975d75c21053ab0f2a316ea0b05d6a9b6b0c6948fd7c361f6c8d156de377c42d83af64eff48a614a6efc23723e707bfa7b7cd759f4509fcf668c2476da8aa9716e21168c63d557f470dc72324f4b1df01be6e8962a57861d410d6dfec9be1708b962000a3b820954b618e4c27db922d4a01ec6a3f88dd9c88d539c0e9d69268d77a1e0a96d1df0c29b8a1372c9d8916c06893f4efa4f66348c087ce40bc11eda9e3eee706c7cb3b457571ff1d177a7940cd1bea2af66e495f0c8ddbf19b14bbfa4d4334e743027820191bb12de0747a299599e7ea7dcd5780b99f124708e38e34e28e328469ae2941d03deb2f8ff70b7dddb0ce08c11824435172864f29b86b0d3566b136261bff157ff4c91f64127f8cfb123d790a0a35e4c440bbc2c3cfd7564c4be440cd0c8ecb43baf20f7255596403a0385c44c8aa401f01b1f2b27dd1e4fb464cc34be22d7e79a79f04b3d99e80a3767110b3ce1af3f018cd6402485c25b6194f0fccf4fad8d16e4a2e6827783aea06f4c3f146d7752be18faec676657e787072a674312ca23e3833045859460010c780c35aaf31c0279519f69e4d1bd851264e767767f307786db021d1016bc2bc7d261ea386ee623619bc834ca736341fdfe3cc2cfde7d1be299808c8fe7c95e1202634380b173067c7909fde3c772ac46179d5d21fe771d5628b025dfbbf24604dfdafa143743e25a4f2c293b1ef2a6edb271e0fcd00245bf883246ddf44429096eae01a31926aa0951e0b4502d2c8480298607db005a493cf832617fe44b8de71e124d987ba7b9edf0232a25a2c5bf837462fe16a6c82b23d0207eec2d035c7043acf3120158e2ea6febe7395be74cfb1e22deecabc9fa5706c2017105c4cbcc28751db5d50d9b51be660ea19ed8c435950e5dd3d4a5b32cf630a06e6d33d82d75f7a4183da1bff14c708c6c1d16c7972e042d5b0308d7d19e32a21bc399944b55eb6451983e3697d95930b0e89a5afbba9b1da2e4245cf26502e63e2e9d34ef4e9e05145b939e76d54573e9a6d472b2fdab9517c8c695f6a982703cbe3be678c13aaa85b9a7f13883a220563b1cef980b51ac554cc4d4b35e309f95e4a6c70bc8c16794737c392be376d0cf1b25d7881374a50ae8e456e10342294f74684d6b192c1b1d68b7ae8108d4410e23ae43ccb8d74f705578183b9c221212d71d9e22e9cf921629b49a9145c905bc1269f028483567c458fd98152fd2eb68c77b1ee4371b79d475f6f3b2e7fe796bf8e2246c8c9aa2f4232d010b72d1da0960b990392313ad255f00615a53d79771cc2c1990f0f26ad1ce0dc25b3c7139a9124a10769755d5866d004661f94fb88f9704c0d43b992a3b518d420f5b30784f7245b9be11ce6a7ffe4e4b6a2a01722d557b881471188a468acbea75d592480483f4012d2c55009d6322f4d9619cb75c214b476c6ffcb29b9062c576c9d05565f68a698336d04ae101842c8e25c87d34b1f614a5e5750c23170827ae48c2c38172beff83f8773728a86aaa58631c1c3c09115e88a289c111a8573ddcae4018f4c54a01e5eb7cd9a8d8a7860d76aa51bd0a70097b757d47b04f636d5aad801b4a37331e5f960286d179ae377ab3c3e68031aa654d93b510310356fbac2dc11dac55bad4164b7732a59c80352b4e464b4845d1853070b29f93f60f039c6ce0908b44164367e2e14eb2763e1125bd27962eee1d3b55e74fddf8adb11689a2c19314d99f57c1c44395e8e11a01e7c595c11050e1d87734442a028e02ffe12a5136ba994619f0486acfc37ccbb53731a4545d33cf5333ea8e636526d8d8ce5a415d4ce7eafcaadcc5555dbc68069834cf3bd6bf3398085064a8750d3275e697006dead2fa1d6ee92a59d44611726cea7e112ed8beac1884bdf33b49262b8150808edf942e105bb680c3f352fe0b963f6d7589ab51d79a0ba0b98e4fa6cc3b4ac1d853e15be967b7cc7a46a35779728616dbd8bf8b1a1d4ec82485d369e4cd9890951829898284ddb0227d7a6281bc9e6119cf968aed15e246f18cd8b65d16fa9018619cea6f2df0595c3dcf234cae21e8d3aaab2cbb167a244dab3e6fceb403427ff9b62e3a7251a6f2537fdec88e7d08fbbd863e28dc9f19feb78f9fdb8105d2f4594922474e7fdf9a57a2e685fef1ec4a029145256ad03b5dd91c7d5297ee02642e19840963c760b7a209501f06ff5fa3f51d83cd14690447f03426de0c18205ae32c7a25a32f9dc1c8df00e8ce40a5a10d5a524b11e300b35b3c8437bc11c193d6c199203df7e3763dce77f4089452f105a86dbd87e080f001cf9dfbe37131514cf8c895f040dc199908ba1065c17e47742fd1a560c50ea0d021ff69699b4041fe36a7c65f1d52abb97d187e2970342177de85ab7a13ffa540a8d4a38df971da90c8379241f04badaea2410feab604900b92e233b773d72bc50ffde124add00ed1759d08463313b292e61778863bdc4d4cf6aba7117167aefc683c33095f303407e150b51d14205368544038f527f82c5693467df1cde4cb28b60ed2db9012323385f35dcb580074a17f868f3b5936fd9e0cbe3c1195ecad53b0ffb0330802669af40f39316b8e172264dc4512c45e133ba1909adc671d47a09616c42763b1a45084df0ae5c4a574204eed07c7adbdf6f7c5ddb2c17cfc205dfa62e6ee603060db200d2993a75cdaf95b00f2cee94f88b8f407377a0ef90476eaa8f6277bd0ef8e6f56ffb647532686ddd258b96a7a057b072155426afe00a27e56a840953";
bytes32[] memory publicInputs = new bytes32[](8);
publicInputs[0] = bytes32(uint256(0x1070c72d42a610a25de25958e699b24d57a8be6cc6d30b7f4ca653bf5df654f9));
publicInputs[1] = bytes32(uint256(0x1a968c159c7dbfe725cb726150182a6581d0a1c60ca49525ed089d4e663fbcd7));
publicInputs[2] = bytes32(uint256(0x2799032e97e735bfcf107028191729aa40dd1f4db2c48f624cd592dcc5f4b9dd));
publicInputs[3] = bytes32(uint256(0x223c1bee236f24b0866ec288b0a06292d6eab565b10f684a86a34cb3c4fe10f0));
publicInputs[4] = bytes32(uint256(0x240beb20aacf495f9d583438bf39e7a671bdaaaadab742c3d7f5fb13945a4a86));
publicInputs[5] = bytes32(uint256(0x2b6306430cbe123ce491dd7047926cf3539f46b378bb96f274bcf902c899073b));
publicInputs[6] = bytes32(uint256(0x069962f9ca7b04fd44525e7226aa82a39a4519cb4e89b02f6557dc13e94817c9));
publicInputs[7] = bytes32(uint256(0x2c20723fa1519f29597f65660496e1a5bcd480e085516f954fc355b617daeec8));
        // This is what we're measuring
        uint256 gasBefore = gasleft();
        bool valid = verifier.verify(proof, publicInputs);
        uint256 gasUsed = gasBefore - gasleft();

        console.log("Verification gas used:", gasUsed);
        console.log("Valid:", valid);
    }

    /// @notice Profile gas for individual Poseidon hash
    function test_PoseidonHash() public view {
        uint256 a = 0x1234;
        uint256 b = 0x5678;

        uint256 gasBefore = gasleft();
        PoseidonT3.hash([a, b]);
        uint256 gasUsed = gasBefore - gasleft();

        console.log("Single Poseidon hash:", gasUsed);
    }

    /// @notice Profile gas for merkle tree insert (20 levels = 20 hashes)
    function test_MerkleInsert20Levels() public view {
        uint256 leaf = 0x1234;
        uint256[20] memory siblings;
        for (uint i = 0; i < 20; i++) {
            siblings[i] = uint256(keccak256(abi.encode(i)));
        }

        uint256 gasBefore = gasleft();
        uint256 current = leaf;
        for (uint256 i = 0; i < 20; i++) {
            current = PoseidonT3.hash([current, siblings[i]]);
        }
        uint256 gasUsed = gasBefore - gasleft();

        console.log("Merkle insert (20 Poseidon):", gasUsed);
    }

    /// @notice Profile gas for ciphertext hash (10 fields -> ~5 hashes)
    function test_CiphertextHash() public view {
        uint256[5][2] memory notes;
        for (uint i = 0; i < 2; i++) {
            for (uint j = 0; j < 5; j++) {
                notes[i][j] = uint256(keccak256(abi.encode(i, j)));
            }
        }

        uint256 gasBefore = gasleft();
        // hash_4 for first note
        uint256 h1 = PoseidonT3.hash([notes[0][0], notes[0][1]]);
        uint256 h2 = PoseidonT3.hash([notes[0][2], notes[0][3]]);
        uint256 note0Hash = PoseidonT3.hash([PoseidonT3.hash([h1, h2]), notes[0][4]]);
        // hash_4 for second note
        h1 = PoseidonT3.hash([notes[1][0], notes[1][1]]);
        h2 = PoseidonT3.hash([notes[1][2], notes[1][3]]);
        uint256 note1Hash = PoseidonT3.hash([PoseidonT3.hash([h1, h2]), notes[1][4]]);
        // final hash
        PoseidonT3.hash([note0Hash, note1Hash]);
        uint256 gasUsed = gasBefore - gasleft();

        console.log("Ciphertext hash (10 fields):", gasUsed);
    }

    /// @notice Profile gas for nullifier SSTORE (cold)
    function test_NullifierStoreCold() public {
        uint256 nullifier = 0x1234;

        uint256 gasBefore = gasleft();
        assembly {
            sstore(nullifier, 1)
        }
        uint256 gasUsed = gasBefore - gasleft();

        console.log("Nullifier SSTORE (cold):", gasUsed);
    }

    /// @notice Summary of measured transfer costs
    function test_TransferGasSummary() public pure {
        // Actual measured values from tests above
        console.log("=== Transfer Gas Breakdown (measured) ===");
        console.log("");
        console.log("EXECUTION:");
        console.log("  ZK Verifier:          2,653,918");
        console.log("  2x Merkle insert:     1,208,224 (2 x 604,112)");
        console.log("  Ciphertext hash:        272,905");
        console.log("  3x SSTORE (cold):        66,345 (3 x 22,115)");
        console.log("  Other (checks):          50,000");
        console.log("  Subtotal:            ~4,251,392");
        console.log("");
        console.log("CALLDATA (16 gas/byte non-zero):");
        console.log("  Proof (~10KB):         ~163,000");
        console.log("  Encrypted notes (320B): ~5,000");
        console.log("  Other params:           ~10,000");
        console.log("  Subtotal:              ~178,000");
        console.log("");
        console.log("EVENTS (375 + 8*bytes + 256*topics):");
        console.log("  Transfer event:        ~100,000");
        console.log("  2x LeafInserted:        ~20,000");
        console.log("  Subtotal:              ~120,000");
        console.log("");
        console.log("BASE TX:                   21,000");
        console.log("");
        console.log("-----------------------------------------");
        console.log("ESTIMATED TOTAL:       ~4,570,392");
        console.log("(Actual may vary with cold/warm slots)");
    }
}
